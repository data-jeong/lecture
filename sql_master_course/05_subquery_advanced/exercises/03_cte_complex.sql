-- Chapter 05: CTE(Common Table Expression) 복합 실습 문제
-- CTE를 활용하여 복잡한 분석 쿼리를 작성하세요.

-- 문제 1: 고객 세그멘테이션 분석을 CTE로 구현하세요.
-- RFM 분석 (Recency, Frequency, Monetary)를 수행하여 고객을 5단계로 분류하세요.
-- 최종 결과: 고객명, 최근 주문일, 주문 횟수, 총 구매액, RFM 점수, 고객 등급
-- 힌트: 다중 CTE 사용


-- 문제 2: 조직도를 재귀 CTE로 구현하세요.
-- 각 직원의 계층 구조와 해당 레벨까지의 전체 경로를 표시하세요.
-- 직원명, 직급, 상사명, 조직 레벨, 조직 경로를 표시하세요.
-- 힌트: RECURSIVE CTE 사용


-- 문제 3: 제품 성과 분석을 다중 CTE로 구현하세요.
-- 각 상품의 판매 성과, 수익성, 고객 만족도를 종합 분석하세요.
-- 상품명, 매출액, 수익률, 평균 평점, 재구매율, 종합 점수를 표시하세요.
-- 힌트: 여러 CTE를 연결하여 최종 분석


-- 문제 4: 이동 평균을 계산하는 CTE를 작성하세요.
-- 월별 매출의 3개월 이동 평균을 계산하여 트렌드를 분석하세요.
-- 년월, 월별 매출, 3개월 이동평균, 전월 대비 증감률을 표시하세요.
-- 힌트: 자기 참조 CTE 활용


-- 문제 5: 복잡한 재고 최적화 로직을 CTE로 구현하세요.
-- 각 상품의 적정 재고량을 계산하고 현재 재고와 비교하여 조치사항을 제안하세요.
-- 상품명, 현재 재고, 월평균 판매량, 적정 재고량, 재고 상태, 조치사항을 표시하세요.
-- 힌트: 복잡한 비즈니스 로직을 단계별 CTE로 분해


-- 문제 6: 고객 생애 가치(CLV) 예측을 CTE로 구현하세요.
-- 고객의 과거 구매 패턴을 분석하여 향후 12개월 예상 매출을 계산하세요.
-- 고객명, 평균 주문 주기, 평균 주문액, 예상 주문 횟수, 예상 CLV를 표시하세요.
-- 힌트: 통계적 계산을 CTE로 단계화


-- 문제 7: 카테고리별 시장 점유율 변화를 분석하는 CTE를 작성하세요.
-- 분기별 카테고리 매출 점유율과 변화 추이를 분석하세요.
-- 카테고리, 분기, 매출액, 점유율, 이전 분기 대비 변화를 표시하세요.
-- 힌트: 윈도우 함수 대신 CTE로 구현


-- 문제 8: 상품 추천 알고리즘을 CTE로 구현하세요.
-- 협업 필터링 기반으로 고객별 상품 추천을 생성하세요.
-- 대상 고객, 추천 상품, 유사 고객들의 구매율, 추천 점수를 표시하세요.
-- 힌트: 복잡한 유사도 계산을 CTE로 단계화


-- 문제 9: 부서별 성과 대시보드를 CTE로 구현하세요.
-- 각 부서의 인력, 예산, 성과 지표를 종합 분석하세요.
-- 부서명, 직원수, 평균급여, 예산 대비 지출률, 생산성 지수, 성과 등급을 표시하세요.
-- 힌트: 여러 테이블의 데이터를 CTE로 통합 분석


-- 문제 10: 재귀 CTE를 사용한 상품 카테고리 계층 분석을 수행하세요.
-- (가상의 계층형 카테고리 구조가 있다고 가정)
-- 각 카테고리와 하위 카테고리의 총 매출을 계산하세요.
-- 카테고리 경로, 계층 레벨, 직접 매출, 하위 포함 총 매출을 표시하세요.
-- 힌트: RECURSIVE CTE로 계층 구조 처리


-- 문제 11: 고객 행동 패턴 분석을 CTE로 구현하세요.
-- 고객의 구매 패턴을 시간대별, 요일별, 계절별로 분석하세요.
-- 고객명, 선호 시간대, 선호 요일, 계절별 구매 패턴, 행동 타입을 표시하세요.
-- 힌트: 복잡한 시간 분석을 CTE로 단계화


-- 문제 12: 가격 최적화 시뮬레이션을 CTE로 구현하세요.
-- 각 상품의 가격 변동 시나리오별 예상 매출을 계산하세요.
-- 상품명, 현재 가격, 시나리오별 가격(-10%, -5%, +5%, +10%), 각 시나리오별 예상 매출을 표시하세요.
-- 힌트: 가격 탄력성 계산을 CTE로 구현


-- 문제 13: 공급망 분석을 CTE로 구현하세요.
-- 상품별 재고 회전율, 품절 위험도, 공급업체 의존도를 종합 분석하세요.
-- 상품명, 재고 회전율, 품절 위험도, 공급업체 집중도, 위험 등급을 표시하세요.
-- 힌트: 복잡한 공급망 지표를 CTE로 계산


-- 문제 14: 마케팅 캠페인 효과 분석을 CTE로 구현하세요.
-- (가상의 campaign 테이블이 있다고 가정)
-- 캠페인별 ROI, 고객 획득 비용, 생애 가치를 계산하세요.
-- 캠페인명, 투자 비용, 신규 고객수, 매출 증가, ROI, CAC를 표시하세요.
-- 힌트: 마케팅 지표를 CTE로 단계별 계산


-- 문제 15: 예측 모델링을 CTE로 구현하세요.
-- 선형 회귀를 사용하여 다음 분기 매출을 예측하세요.
-- 과거 분기별 매출 데이터를 기반으로 트렌드를 분석하고 예측값을 계산하세요.
-- 분기, 실제 매출, 예측 매출, 신뢰구간, 예측 정확도를 표시하세요.
-- 힌트: 통계적 계산을 SQL로 구현하는 고급 CTE