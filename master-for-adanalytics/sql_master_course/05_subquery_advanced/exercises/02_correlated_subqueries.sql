-- Chapter 05: 상관 서브쿼리 실습 문제
-- 각 문제를 해결하는 SQL 쿼리를 작성하세요.

-- 문제 1: 각 부서에서 급여가 상위 3위 안에 드는 직원을 조회하세요.
-- 상관 서브쿼리를 사용하여 해결하세요.
-- 결과: 부서명, 직원명, 급여, 부서내 순위
-- 힌트: COUNT를 사용한 상관 서브쿼리로 순위 계산


-- 문제 2: 각 고객의 최신 주문 정보를 조회하세요.
-- 고객명, 최신 주문일, 주문 총액을 표시하세요.
-- 힌트: 상관 서브쿼리로 MAX(order_date) 활용


-- 문제 3: 각 카테고리에서 가장 인기있는 상품(주문 수량 기준)을 조회하세요.
-- 카테고리명, 상품명, 총 주문 수량을 표시하세요.
-- 힌트: 상관 서브쿼리로 카테고리별 최대 주문 수량 비교


-- 문제 4: 각 직원보다 급여가 높은 동일 부서 직원의 수를 조회하세요.
-- 직원명, 부서, 급여, 자신보다 급여가 높은 동료 수를 표시하세요.
-- 힌트: COUNT와 상관 서브쿼리 조합


-- 문제 5: 평균 주문 금액보다 큰 주문을 한 고객의 총 주문 수를 조회하세요.
-- 고객별로 평균 이상 주문 횟수를 계산하세요.
-- 결과: 고객명, 총 주문 수, 평균 이상 주문 수, 비율(%)
-- 힌트: 이중 상관 서브쿼리 사용


-- 문제 6: 각 상품에 대해 해당 카테고리의 평균 가격과 비교하여 비싼지 저렴한지 표시하세요.
-- 상품명, 가격, 카테고리 평균 가격, 가격 구분(비쌈/저렴/평균)을 표시하세요.
-- 힌트: CASE문과 상관 서브쿼리 조합


-- 문제 7: 재고가 부족한 상품을 식별하세요.
-- 재고량이 해당 카테고리 평균 재고의 50% 이하인 상품을 조회하세요.
-- 결과: 상품명, 현재 재고, 카테고리 평균 재고, 부족률(%)
-- 힌트: 상관 서브쿼리로 카테고리별 평균 계산


-- 문제 8: 각 월별로 신규 고객 수를 조회하세요.
-- 해당 월에 처음 주문한 고객의 수를 계산하세요.
-- 결과: 년월, 전체 주문 고객 수, 신규 고객 수, 신규 고객 비율(%)
-- 힌트: NOT EXISTS와 상관 서브쿼리로 이전 주문 확인


-- 문제 9: 각 직원의 성과를 동일 직급의 평균과 비교하세요.
-- 직원명, 직급, 개인 성과, 직급 평균 성과, 상대적 성과를 표시하세요.
-- 힌트: employee_performance 테이블 활용, 상관 서브쿼리로 직급별 평균 계산


-- 문제 10: 고객별 충성도 점수를 계산하세요.
-- 주문 빈도, 평균 주문 금액, 최근 주문일을 종합하여 점수를 산정하세요.
-- 결과: 고객명, 주문 빈도 점수, 금액 점수, 최신성 점수, 총 충성도 점수
-- 힌트: 각 지표별로 상관 서브쿼리로 백분위 계산


-- 문제 11: 각 상품의 계절별 판매 성과를 분석하세요.
-- 상품별로 각 계절(분기)의 매출이 연간 평균 대비 어떤지 조회하세요.
-- 결과: 상품명, 분기, 분기 매출, 연간 평균 매출, 성과 지수
-- 힌트: CASE문으로 분기 분류, 상관 서브쿼리로 연간 평균 계산


-- 문제 12: 경쟁 상품 분석을 수행하세요.
-- 각 상품과 동일 카테고리에서 가격이 유사한(±10%) 상품의 수를 조회하세요.
-- 결과: 상품명, 가격, 경쟁 상품 수, 가격 경쟁력(상위/하위 몇%)
-- 힌트: 복잡한 상관 서브쿼리로 가격 범위 내 상품 카운트


-- 문제 13: 부서별 급여 분산도를 계산하세요.
-- 각 부서의 급여 표준편차와 변동계수를 구하고, 전체 평균과 비교하세요.
-- 결과: 부서명, 평균 급여, 표준편차, 변동계수, 전체 대비 분산도
-- 힌트: 상관 서브쿼리로 부서별 통계 계산


-- 문제 14: 고객의 구매 패턴 변화를 분석하세요.
-- 각 고객의 최근 3개월 주문과 이전 3개월 주문을 비교하여 변화율을 계산하세요.
-- 결과: 고객명, 최근 3개월 주문액, 이전 3개월 주문액, 변화율(%), 트렌드
-- 힌트: 복잡한 날짜 조건의 상관 서브쿼리


-- 문제 15: 상품별 교차 판매(Cross-selling) 기회를 식별하세요.
-- 각 상품과 함께 자주 구매되는 다른 카테고리 상품을 찾으세요.
-- 결과: 기준 상품, 연관 카테고리, 동시 구매 횟수, 연관도(%)
-- 힌트: EXISTS와 상관 서브쿼리로 동일 주문 내 다른 카테고리 상품 확인