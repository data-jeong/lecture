-- Chapter 06: 고급 분석 윈도우 함수 실습 문제
-- 복잡한 비즈니스 로직을 윈도우 함수로 구현하세요.

-- 문제 1: 3개월과 6개월 이동 평균을 동시에 계산하세요.
-- 월별 매출 데이터를 사용하여 매출 트렌드를 분석하세요.
-- 결과: 년월, 월별 매출, 3개월 이동평균, 6개월 이동평균
-- 힌트: 월별 집계 후 윈도우 함수 적용


-- 문제 2: 직원들을 성과 점수 기준으로 백분위수를 계산하고 등급을 부여하세요.
-- 상위 10%는 'A', 11-30%는 'B', 31-70%는 'C', 하위 30%는 'D' 등급
-- 결과: 직원명, 부서, 평균 성과, 백분위수, 등급
-- 힌트: PERCENT_RANK() 사용 후 CASE 문으로 등급 분류


-- 문제 3: 각 부서별로 급여 비율과 누적 급여 비율을 계산하세요.
-- 결과: 부서, 직원명, 급여, 부서내 급여 비율(%), 부서내 누적 급여 비율(%)
-- 힌트: SUM() OVER의 다양한 FRAME 활용


-- 문제 4: Top N per Group 패턴을 구현하세요.
-- 각 카테고리별 상위 2개 상품과 각 부서별 상위 3명 직원을 동시에 조회하세요.
-- 힌트: 두 개의 서브쿼리를 UNION으로 결합


-- 문제 5: Gap과 Island 문제를 해결하세요.
-- 연속된 날짜에 매출이 있는 기간들을 그룹화하세요.
-- 결과: 그룹 번호, 연속 기간 시작일, 종료일, 기간내 총 매출
-- 힌트: ROW_NUMBER()를 이용한 날짜 차이 계산


-- 문제 6: 고객별 주문 패턴 분석을 수행하세요.
-- 각 고객의 주문 간격, 평균 주문 간격, 주문 빈도 변화를 분석하세요.
-- 결과: 고객명, 주문일, 이전 주문과의 간격, 평균 주문 간격, 주문 빈도 트렌드
-- 힌트: LAG, AVG() OVER 조합 사용


-- 문제 7: 상품별 재고 회전율을 계산하세요.
-- 각 상품의 월별 재고 회전율과 이동 평균 회전율을 구하세요.
-- 결과: 상품명, 월, 재고 회전율, 3개월 평균 회전율
-- 힌트: 입고량 대비 출고량 비율 계산


-- 문제 8: 계절성 분석을 수행하세요.
-- 월별 매출의 계절성 지수를 계산하고 전년 동월 대비 성장률을 구하세요.
-- 결과: 년월, 월별 매출, 계절성 지수, 전년 동월 대비 성장률
-- 힌트: 12개월 LAG 사용


-- 문제 9: 고객 이탈 예측을 위한 RFM 스코어링을 구현하세요.
-- Recency, Frequency, Monetary를 각각 1-5점으로 스코어링하세요.
-- 결과: 고객명, R점수, F점수, M점수, 총합, 고객 세그먼트
-- 힌트: NTILE() 함수를 이용한 점수 분배


-- 문제 10: 부서별 성과 벤치마킹을 수행하세요.
-- 각 부서의 성과를 다른 부서들과 비교 분석하세요.
-- 결과: 부서, 평균 성과, 전체 평균 대비 차이, 상대적 순위, 성과 분위수
-- 힌트: 다양한 윈도우 함수 조합


-- 문제 11: 동적 베이스라인 분석을 구현하세요.
-- 각 시점에서의 과거 N일 평균을 기준으로 현재값의 편차를 계산하세요.
-- 결과: 날짜, 매출, 30일 베이스라인, 편차, 편차율, 시그널(정상/이상)
-- 힌트: 이동 평균과 표준편차 계산


-- 문제 12: 제품 라이프사이클 분석을 수행하세요.
-- 각 상품의 출시 후 월별 성장률 변화를 분석하여 라이프사이클 단계를 판단하세요.
-- 결과: 상품명, 출시후 개월수, 월별 성장률, 성장률 트렌드, 라이프사이클 단계
-- 힌트: 복잡한 성장률 계산과 트렌드 분석


-- 문제 13: 경쟁 포지셔닝 분석을 구현하세요.
-- 각 상품을 가격과 판매량 기준으로 2x2 매트릭스에 포지셔닝하세요.
-- 결과: 상품명, 가격 분위, 판매량 분위, 포지셔닝(스터, 물음표, 현금소, 개)
-- 힌트: NTILE()을 이용한 2x2 매트릭스 생성


-- 문제 14: 고객 여정 분석을 수행하세요.
-- 각 고객의 주문 여정에서 구매 패턴 변화를 분석하세요.
-- 결과: 고객명, 주문 순서, 주문 금액, 누적 금액, 구매 패턴 변화, 고객 가치 트렌드
-- 힌트: ROW_NUMBER, 누적 함수, 트렌드 분석 조합


-- 문제 15: 다차원 성과 대시보드를 구현하세요.
-- 매출, 고객수, 주문수를 종합한 복합 성과 지표를 계산하세요.
-- 각 지표별 가중치를 적용하여 종합 성과 점수를 산출하세요.
-- 결과: 기간, 매출 점수, 고객 점수, 주문 점수, 종합 점수, 성과 등급, 트렌드
-- 힌트: 정규화된 점수 계산과 가중 평균 적용